<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="room.css">
		<script src="jquery-3.4.0.min.js"></script>
	</head>
	<body>
	<header>
		<h1>Webchat </h1>
	</header>
	<div id="room">
			<div >
				<ul id="messages">

				</ul>
			</div>
			<input type="text" id="message" value="message"/>
			<input type="button" id="send" value="send" onclick="sendMessage()" />
	</div>
	<div id="users">

	</div>
	</body>

	<script>
		//AJAX request to subscribe to the longpollig and get a listener
		function subscribe(callback) {
			function longPoll(){
				$.ajax({
					method: 'GET',
					url: '/room',
					dataType: 'json',
					success: function(data){
						//When data is received it's added to the chatbox
						$("#messages").append("<li>"+data+"</li>");;
					},
					complete: function(){
						//After adding to the chatbox it starts to listen again for new data
						longPoll()
					},
					error: function(){console.log("ERROR!")},
					timeout: 60000
				})
			}
			longPoll()
		}

		function sendMessage(){
			//I create a JSON object and then make it in a string, naming could be better
			var message = document.getElementById('message').value;
			var messageObj = {message: message};
			var messageObjJson = JSON.stringify(messageObj);
			//Setup for the XHRequest
			var XHR = new XMLHttpRequest();
			var url = 'room';
			XHR.open('POST', url, true);
			XHR.setRequestHeader('Content-type', 'application/json');
			XHR.setRequestHeader('X-Requested-With',' XMLHttpRequest');
			XHR.send(messageObjJson);
			console.log(messageObjJson + " sent");
		}

		$(document).ready(subscribe());
	</script>

</html>
	